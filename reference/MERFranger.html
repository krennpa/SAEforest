<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="This function enables the use of Mixed Effects Random Forests (MERFs) by effectively
combining a random forest from ranger with a model capturing random effects from
lme4. The MERF algorithm is an algorithmic procedure reminiscent of an EM-algorithm
(see Details). The function is the base-function for the wrapping function (SAEforest_model
and should not be directly used by the ordinary user. Recommended exceptions are applications exceeding
the scope of existing wrapper functions or further research. The function MERFranger
allows to model complex patterns of structural relations (see Examples). The function returns
an object of class MERFranger, which can be used to produce unit-level predictions. In contrast to
the wrapping functions, this function does not directly provide SAE estimates on domain-specific indicators."><title>Main function for unit-level MERF — MERFranger • SAEforest</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Main function for unit-level MERF — MERFranger"><meta property="og:description" content="This function enables the use of Mixed Effects Random Forests (MERFs) by effectively
combining a random forest from ranger with a model capturing random effects from
lme4. The MERF algorithm is an algorithmic procedure reminiscent of an EM-algorithm
(see Details). The function is the base-function for the wrapping function (SAEforest_model
and should not be directly used by the ordinary user. Recommended exceptions are applications exceeding
the scope of existing wrapper functions or further research. The function MERFranger
allows to model complex patterns of structural relations (see Examples). The function returns
an object of class MERFranger, which can be used to produce unit-level predictions. In contrast to
the wrapping functions, this function does not directly provide SAE estimates on domain-specific indicators."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">SAEforest</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/krennpa/SAEforest/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Main function for unit-level MERF</h1>
      <small class="dont-index">Source: <a href="https://github.com/krennpa/SAEforest/blob/HEAD/R/MERFranger.R" class="external-link"><code>R/MERFranger.R</code></a></small>
      <div class="d-none name"><code>MERFranger.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function enables the use of Mixed Effects Random Forests (MERFs) by effectively
combining a random forest from <span class="pkg">ranger</span> with a model capturing random effects from
<span class="pkg">lme4</span>. The MERF algorithm is an algorithmic procedure reminiscent of an EM-algorithm
(see Details). The function is the base-function for the wrapping function (<code><a href="SAEforest_model.html">SAEforest_model</a></code>
and should not be directly used by the ordinary user. Recommended exceptions are applications exceeding
the scope of existing wrapper functions or further research. The function <code>MERFranger</code>
allows to model complex patterns of structural relations (see Examples). The function returns
an object of class <code>MERFranger</code>, which can be used to produce unit-level predictions. In contrast to
the wrapping functions, this function does not directly provide SAE estimates on domain-specific indicators.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">MERFranger</span><span class="op">(</span></span>
<span>  <span class="va">Y</span>,</span>
<span>  <span class="va">X</span>,</span>
<span>  <span class="va">random</span>,</span>
<span>  <span class="va">data</span>,</span>
<span>  importance <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>  initialRandomEffects <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  ErrorTolerance <span class="op">=</span> <span class="fl">1e-04</span>,</span>
<span>  MaxIterations <span class="op">=</span> <span class="fl">25</span>,</span>
<span>  na.rm <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>Y</dt>
<dd><p>Continuous input value of target variable.</p></dd>


<dt>X</dt>
<dd><p>Matrix of predictive covariates.</p></dd>


<dt>random</dt>
<dd><p>Specification of random effects terms following the syntax of <a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lmer</a>.
Random effect terms are specified by vertical bars <code>(|)</code> separating expressions for design matrices
from grouping factors. For further details see <a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lmer</a> and the example below.</p></dd>


<dt>data</dt>
<dd><p>data.frame of sample data including the specified elements of <code>Y</code> and
<code>X</code>.</p></dd>


<dt>importance</dt>
<dd><p>Variable importance mode processed by the
random forest from the <span class="pkg">ranger</span>. Must be 'none', 'impurity', 'impurity_corrected',
'permutation'. For further details see <a href="http://imbs-hl.github.io/ranger/reference/ranger.html" class="external-link">ranger</a>.</p></dd>


<dt>initialRandomEffects</dt>
<dd><p>Numeric value or vector of initial estimate of random effects.
Defaults to 0.</p></dd>


<dt>ErrorTolerance</dt>
<dd><p>Numeric value to monitor the MERF algorithm's convergence. Defaults to 1e-04.</p></dd>


<dt>MaxIterations</dt>
<dd><p>Numeric value specifying the maximal amount of iterations for the
MERF algorithm. Defaults to 25.</p></dd>


<dt>na.rm</dt>
<dd><p>Logical. Whether missing values should be removed. Defaults to <code>TRUE</code>.</p></dd>


<dt>...</dt>
<dd><p>Additional parameters are directly passed to the random forest <a href="http://imbs-hl.github.io/ranger/reference/ranger.html" class="external-link">ranger</a>.
Most important parameters are for instance <code>mtry</code> (number of variables to possibly split at
in each node), or <code>num.trees</code> (number of trees). For further details on possible parameters
see <a href="http://imbs-hl.github.io/ranger/reference/ranger.html" class="external-link">ranger</a> and the example below.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>An object of class MERFranger includes the following elements:</p>
<dl><dt><code>Forest</code></dt>
<dd><p>A random forest of class <a href="http://imbs-hl.github.io/ranger/reference/ranger.html" class="external-link">ranger</a> modelling fixed effects
of the model.</p></dd>

<dt><code>EffectModel</code></dt>
<dd><p>A model of random effects of class <code><a href="https://rdrr.io/pkg/lme4/man/merMod-class.html" class="external-link">merMod</a></code> capturing
structural components of MERFs and modeling random components.</p></dd>

<dt><code>RandomEffects</code></dt>
<dd><p>List element containing the values of random intercepts from <code>EffectModel</code>.</p></dd>

<dt><code>RanEffSD</code></dt>
<dd><p>Numeric value of the standard deviation of random intercepts.</p></dd>

<dt><code>ErrorSD</code></dt>
<dd><p>Numeric value of standard deviation of unit-level errors.</p></dd>

<dt><code>VarianceCovariance</code></dt>
<dd><p>VarCorr matrix from <code>EffectModel</code>.</p></dd>

<dt><code>LogLik</code></dt>
<dd><p>Vector with numerical entries showing the loglikelihood of the MERF algorithm.</p></dd>

<dt><code>IterationsUsed</code></dt>
<dd><p>Numeric number of iterations used until convergence of the MERF algorithm.</p></dd>

<dt><code>OOBresiduals</code></dt>
<dd><p>Vector of OOB-residuals.</p></dd>

<dt><code>Random</code></dt>
<dd><p>Character specifying the random intercept in the random effects model.</p></dd>

<dt><code>ErrorTolerance</code></dt>
<dd><p>Numerical value to monitor the MERF algorithm's convergence.</p></dd>

<dt><code>initialRandomEffects</code></dt>
<dd><p>Numeric value or vector of initial specification of random effects.</p></dd>

<dt><code>MaxIterations</code></dt>
<dd><p>Numeric value specifying the maximal amount of iterations for the
MERF algorithm.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>There exists a generic function for <code>predict</code> for objects obtained by <code>MERFranger</code>.</p>
<p>The MERF algorithm iteratively optimizes two separate steps: a) the random forest
function, assuming the random effects term to be correct and b) estimates the random
effects part, assuming the OOB-predictions from the forest to be correct. Overall convergence
of the algorithm is monitored by the log-likelihood of a joint model of both components. For
further details see Krennmair &amp; Schmid (2022) or Hajjem et al. (2014).</p>
<p>Note that the <code>MERFranger</code> object is a composition of elements from a random forest of class
<code>ranger</code> and a random effects model of class <code><a href="https://rdrr.io/pkg/lme4/man/merMod-class.html" class="external-link">merMod</a></code>. Thus, all generic functions are
applicable to corresponding objects. For further details on generic functions see <code><a href="http://imbs-hl.github.io/ranger/reference/ranger.html" class="external-link">ranger</a></code>
and <code><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lmer</a></code> as well as the examples below.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Hajjem, A., Bellavance, F., &amp; Larocque, D. (2014). Mixed-Effects Random Forest for Clustered
Data. Journal of Statistical Computation and Simulation, 84 (6), 1313–1328.</p>
<p>Krennmair, P., &amp; Schmid, T. (2022). Flexible Domain Prediction Using Mixed Effects
Random Forests. Journal of Royal Statistical Society: Series C (Applied Statistics) (forthcoming).</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="SAEforest.html">SAEforest</a></code>, <code><a href="http://imbs-hl.github.io/ranger/reference/ranger.html" class="external-link">ranger</a></code>, <code><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lmer</a></code>,
<code><a href="SAEforest_model.html">SAEforest_model</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="co"># Load Data</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"eusilcA_pop"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"eusilcA_smp"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">income</span> <span class="op">&lt;-</span> <span class="va">eusilcA_smp</span><span class="op">$</span><span class="va">eqIncome</span></span></span>
<span class="r-in"><span><span class="va">X_covar</span> <span class="op">&lt;-</span> <span class="va">eusilcA_smp</span><span class="op">[</span>, <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">16</span>, <span class="fl">17</span>, <span class="fl">18</span><span class="op">)</span><span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Example 1:</span></span></span>
<span class="r-in"><span><span class="co"># Calculating general model used in wrapper functions</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">model1</span> <span class="op">&lt;-</span> <span class="fu">MERFranger</span><span class="op">(</span>Y <span class="op">=</span> <span class="va">income</span>, X <span class="op">=</span> <span class="va">X_covar</span>, random <span class="op">=</span> <span class="st">"(1|district)"</span>,</span></span>
<span class="r-in"><span>                     data <span class="op">=</span> <span class="va">eusilcA_smp</span>, num.trees<span class="op">=</span><span class="fl">50</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in initializePtr():</span> function 'cholmod_factor_ldetA' not provided by package 'Matrix'</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># get individual predictions:</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">ind_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">model1</span>, <span class="va">eusilcA_pop</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in eval(expr, envir, enclos):</span> object 'model1' not found</span>
<span class="r-in"><span><span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Patrick Krennmair, Nicolas Frink.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

